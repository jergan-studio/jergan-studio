<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jergan Studio</title>
<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: radial-gradient(circle at center, #101020, #000);
  color: white;
  overflow: hidden;
}
header {
  background: rgba(0,0,0,0.8);
  text-align: center;
  padding: 10px;
  font-size: 24px;
  font-weight: bold;
  text-shadow: 0 0 10px #4c5bff;
}
#home, #editor {
  display: none;
  text-align: center;
  padding: 20px;
}
button {
  background: #4c5bff;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 8px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}
button:hover {
  background: #6473ff;
}
#stage {
  width: 90vw;
  height: 60vh;
  background: #111;
  border: 2px solid #333;
  margin: 0 auto;
  position: relative;
  overflow: hidden;
}
.sprite {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  position: absolute;
  background: #4c5bff;
}
#mobileControls {
  display: none;
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
}
.mobileBtn {
  width: 60px;
  height: 60px;
  margin: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.1);
  border: 2px solid #4c5bff;
  color: white;
  font-size: 24px;
}
textarea {
  width: 90%;
  height: 100px;
  background: #111;
  color: #fff;
  border: 1px solid #333;
  border-radius: 5px;
  padding: 8px;
}
/* Version badge */
#version {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(76, 91, 255, 0.7);
  color: white;
  font-size: 14px;
  font-weight: bold;
  padding: 5px 10px;
  border-radius: 5px;
  box-shadow: 0 0 5px #000;
  z-index: 1000;
  cursor: pointer;
}
#versionPopup {
  display: none;
  position: fixed;
  bottom: 50px;
  right: 10px;
  width: 200px;
  background: rgba(0,0,0,0.9);
  border: 2px solid #4c5bff;
  border-radius: 10px;
  padding: 10px;
  font-size: 14px;
  color: #fff;
  text-align: left;
  z-index: 1001;
}
#versionPopup button {
  display: block;
  margin-top: 10px;
  width: 100%;
  background: #6473ff;
}
</style>
</head>
<body>

<header>Jergan Studio</header>

<div id="home">
  <h2>Welcome to Jergan Studio</h2>
  <button onclick="openEditor()">New Project</button>
  <button onclick="loadProject()">Load Local Save</button>
</div>

<div id="editor">
  <div>
    <button onclick="addCircle()">Add Circle</button>
    <button onclick="uploadSprite()">Upload Sprite</button>
    <button onclick="runGame()">Play</button>
    <button onclick="saveLocal()">Save Local</button>
    <button onclick="saveCloud()">Upload to Cloud</button>
    <button onclick="backHome()">Back to Home</button>
  </div>
  <div id="stage"></div>
  <h3>Scripting</h3>
  <textarea id="scriptArea" placeholder="Example: whenKey('ArrowRight', () => move(10, 0));"></textarea>
</div>

<div id="mobileControls">
  <button class="mobileBtn" onclick="simulateKey('ArrowLeft')">⬅️</button>
  <button class="mobileBtn" onclick="simulateKey('ArrowUp')">⬆️</button>
  <button class="mobileBtn" onclick="simulateKey('ArrowDown')">⬇️</button>
  <button class="mobileBtn" onclick="simulateKey('ArrowRight')">➡️</button>
</div>

<!-- Version badge -->
<div id="version" onclick="toggleVersion()">v.1.0</div>
<div id="versionPopup">
  <b>Jergan Studio v1.0</b><br>
  - Home + Editor in one page<br>
  - Sprite editor & upload<br>
  - Keyboard & mobile controls<br>
  - Local save & load<br>
  - Cloud save placeholder<br>
  <button onclick="toggleVersion()">Close</button>
</div>

<script>
// === UI Navigation ===
const home = document.getElementById("home");
const editor = document.getElementById("editor");
const stage = document.getElementById("stage");
const scriptArea = document.getElementById("scriptArea");
const mobileControls = document.getElementById("mobileControls");
let sprites = [];
let activeSprite = null;

window.onload = () => {
  home.style.display = "block";
  if (/Mobi|Android/i.test(navigator.userAgent)) {
    mobileControls.style.display = "block";
  }
};

function openEditor() {
  home.style.display = "none";
  editor.style.display = "block";
}

function backHome() {
  home.style.display = "block";
  editor.style.display = "none";
}

// === Sprite Handling ===
function addCircle() {
  const sprite = document.createElement("div");
  sprite.className = "sprite";
  sprite.style.left = "100px";
  sprite.style.top = "100px";
  stage.appendChild(sprite);
  sprites.push(sprite);
  activeSprite = sprite;
}

function uploadSprite() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.onchange = e => {
    const file = e.target.files[0];
    const url = URL.createObjectURL(file);
    const sprite = document.createElement("div");
    sprite.className = "sprite";
    sprite.style.background = `url(${url}) center/cover`;
    stage.appendChild(sprite);
    sprites.push(sprite);
    activeSprite = sprite;
  };
  input.click();
}

// === Scripting System ===
function whenKey(key, callback) {
  window.addEventListener("keydown", e => {
    if (e.key === key) callback();
  });
}

function move(x, y) {
  if (!activeSprite) return;
  const rect = activeSprite.getBoundingClientRect();
  const sx = stage.getBoundingClientRect();
  let nx = rect.left - sx.left + x;
  let ny = rect.top - sx.top + y;
  nx = Math.max(0, Math.min(nx, stage.clientWidth - rect.width));
  ny = Math.max(0, Math.min(ny, stage.clientHeight - rect.height));
  activeSprite.style.left = nx + "px";
  activeSprite.style.top = ny + "px";
}

// Simulate keypresses for mobile arrows
function simulateKey(key) {
  const event = new KeyboardEvent("keydown", { key });
  window.dispatchEvent(event);
}

// === Game Run ===
function runGame() {
  try {
    eval(scriptArea.value);
  } catch (err) {
    alert("Script error: " + err.message);
  }
}

// === Local Save ===
function saveLocal() {
  const data = {
    script: scriptArea.value,
    sprites: sprites.map(s => ({
      left: s.style.left,
      top: s.style.top,
      background: s.style.background
    }))
  };
  localStorage.setItem("jerganProject", JSON.stringify(data));
  alert("Saved locally!");
}

function loadProject() {
  const data = JSON.parse(localStorage.getItem("jerganProject"));
  if (!data) return alert("No local save found!");
  openEditor();
  stage.innerHTML = "";
  sprites = [];
  data.sprites.forEach(s => {
    const sprite = document.createElement("div");
    sprite.className = "sprite";
    sprite.style.left = s.left;
    sprite.style.top = s.top;
    sprite.style.background = s.background;
    stage.appendChild(sprite);
    sprites.push(sprite);
  });
  scriptArea.value = data.script;
}

// === Cloud Save (Firebase-ready) ===
function saveCloud() {
  alert("Cloud save is ready! Add your Firebase config in the next version.");
}

// === Version badge popup ===
function toggleVersion() {
  const popup = document.getElementById("versionPopup");
  popup.style.display = popup.style.display === "block" ? "none" : "block";
}
</script>

</body>
</html>
